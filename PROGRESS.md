# 小火箭 SDK 开发进度

> 更新日期：2026-02-09

## 📊 总体进度

```
Phase 1: 基础设施    ████████████████████ 100% ✅
Phase 2: 购买验证    ░░░░░░░░░░░░░░░░░░░░   0% ❌
Phase 3: 数据迁移    ████████████░░░░░░░░  60% 🟡
Phase 4: UI 交互     ████░░░░░░░░░░░░░░░░  20% 🟡
Phase 5: 多 App 适配 ░░░░░░░░░░░░░░░░░░░░   0% ❌
Phase 6: 灰度发布    ░░░░░░░░░░░░░░░░░░░░   0% ❌
```

---

## ✅ 已完成

### Phase 1: 基础设施 (Week 1) ✅

| 任务 | 状态 | 详情 |
|------|------|------|
| Supabase 项目 | ✅ | `ra-supabase-sb6xjntrfya75g` 运行中 |
| user_devices 表 | ✅ | public + test_public |
| user_purchases 表 | ✅ | public + test_public |
| profiles 表 | ✅ | 触发器自动创建 |
| RLS 策略 | ✅ | 全部配置完成 |
| 短信登录 | ✅ | 测试通过 (18520160445) |
| 环境隔离 | ✅ | test_public / public |

**交付物：**
- 数据库表结构 ✓
- 短信登录 API ✓
- Flutter SDK 基础 ✓

---

## 🟡 进行中

### Phase 3: 数据迁移 (Week 3) 🟡

| 任务 | 状态 | 详情 |
|------|------|------|
| CloudSyncService | 🟡 | 框架完成，OSS 上传待实现 |
| 设备→用户路径复制 | 🟡 | 逻辑完成，需测试 |
| 多设备数据合并 | ❌ | 框架待实现 |
| 迁移进度 UI | ❌ | 未开始 |
| 数据完整性测试 | ❌ | 未开始 |

**交付物：**
- `CloudSyncService` 类（框架）✓
- OSS 配置获取 ✓
- 路径切换逻辑 ✓

---

### Phase 4: UI 交互 (Week 4) 🟡

| 任务 | 状态 | 详情 |
|------|------|------|
| 登录页面 | ✅ | 完成 |
| 用户信息页面 | ✅ | 完成 |
| 同步测试页面 | 🟡 | 占位页面 |
| 迁移进度提示 | ❌ | 未开始 |
| 购买恢复引导 | ❌ | 未开始 |

**交付物：**
- `example_app` 示例 ✓

---

## ❌ 未开始

### Phase 2: 购买验证 (Week 2) ❌

| 任务 | 状态 | 优先级 | 说明 |
|------|------|--------|------|
| migrate-device-purchase Edge Function | ❌ | P1 | 设备购买迁移 |
| 苹果收据验证 | ❌ | P1 | App Store 验证 |
| 谷歌收据验证 | ❌ | P2 | Play Store 验证 |
| 购买凭证迁移测试 | ❌ | P1 | 端到端测试 |

**依赖：**
- 苹果 App Store Shared Secret
- 谷歌 Play Console API Key

---

### Phase 5: 多 App 适配 (Week 5) ❌

| 任务 | 状态 | 说明 |
|------|------|------|
| SDK 打包发布 | ❌ | pub.dev |
| 申论 App 集成 | ❌ | 测试 |
| 行测 App 集成 | ❌ | 测试 |
| 跨 App 数据隔离 | ❌ | 验证 |

---

### Phase 6: 灰度发布 (Week 6) ❌

| 任务 | 状态 | 说明 |
|------|------|------|
| 内部测试 | ❌ | 多设备场景 |
| 10% 灰度 | ❌ | 小范围测试 |
| 监控迁移成功率 | ❌ | 数据埋点 |
| 全量发布 | ❌ | 正式上线 |

---

## 🔮 其他功能（文档中提到但未详细规划）

### 第三方登录 ❌

| 登录方式 | 状态 | 优先级 | 说明 |
|----------|------|--------|------|
| 手机号 | ✅ | P0 | 已完成 |
| 微信登录 | ❌ | P2 | 需微信开放平台审核 |
| 苹果登录 (Sign in with Apple) | ❌ | P1 | iOS 必需（App Store 要求）|
| 支付宝登录 | ❌ | P3 | 可选 |

**注意：** 架构文档第 98 行提到"手机号/微信/苹果登录"，但只有手机号实现了。

### 高级功能 ❌

| 功能 | 状态 | 优先级 | 说明 |
|------|------|--------|------|
| 数据加密 | ❌ | P1 | 传输 + 存储加密 |
| 离线同步 | ❌ | P2 | 断网后自动同步 |
| 冲突解决策略 | ❌ | P2 | 多种合并策略 |
| 数据备份恢复 | ❌ | P2 | 手动备份 |
| 数据分析埋点 | ❌ | P3 | 迁移成功率统计 |

---

## 📋 本周建议优先级

### 最高优先级（立即做）

1. **完成 CloudSyncService** - OSS 实际上传下载
2. **苹果登录** - App Store 上架必需
3. **购买验证** - 收入相关，必须做

### 中等优先级（下周做）

4. **数据迁移测试** - 完整流程验证
5. **迁移进度 UI** - 用户体验

### 低优先级（后续做）

6. **微信登录** - 可选，提升体验
7. **数据分析** - 发布后优化

---

## 🎯 下一步行动

请选择要做的：

- [ ] **A.** 完成 CloudSyncService（OSS 上传下载）
- [ ] **B.** 接入苹果登录（Sign in with Apple）
- [ ] **C.** 购买验证 Edge Function
- [ ] **D.** 微信登录

建议先做 **A** 或 **B**，因为：
- A 是核心功能，没有它整个同步无法工作
- B 是 App Store 上架必需（如果仅手机号登录会被拒）
