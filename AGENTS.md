# å°ç«ç®­ SDK å¼€å‘è§„èŒƒ

## ğŸ“ Agent å·¥ä½œè§„åˆ™

### 1. ä»£ç æµ‹è¯•åŸåˆ™

> **æ‰€æœ‰ä»£ç å¿…é¡»ç»è¿‡æµ‹è¯•æ‰èƒ½æäº¤**

- ç¼–å†™ä»£ç åï¼Œå¿…é¡»æä¾›æµ‹è¯•ç”¨ä¾‹æˆ–æµ‹è¯•æ­¥éª¤
- ä¿®æ”¹ç°æœ‰ä»£ç æ—¶ï¼Œç¡®ä¿ä¸ç ´ååŸæœ‰åŠŸèƒ½
- å…³é”®æµç¨‹ï¼ˆç™»å½•ã€åŒæ­¥ã€è´­ä¹°è¿ç§»ï¼‰å¿…é¡»æä¾›æµ‹è¯•éªŒè¯æ–¹æ¡ˆ
- ä¸è¦å‡è®¾ä»£ç "åº”è¯¥èƒ½è·‘"ï¼Œè¦å®é™…éªŒè¯

### 2. API Key ä½¿ç”¨è§„èŒƒ

> **éœ€è¦ API Key æ—¶ï¼Œå¿…é¡»æå‰å‘ç”¨æˆ·ç”³è¯·**

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| éœ€è¦æ–°å¢ API Key | å…ˆåˆ—å‡ºæ¸…å•ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤åå†é…ç½® |
| å·²æœ‰ Key åœ¨ç¯å¢ƒå˜é‡ | æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™æé†’ç”¨æˆ· |
| æ•æ„Ÿä¿¡æ¯ | ç»ä¸ç¡¬ç¼–ç ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ |

**å·²çŸ¥çš„ Keyï¼ˆç”¨æˆ·å·²æä¾›ï¼‰:**
- Supabase Anon Key: `eyJ0eXAiOiJKV1Qi...`
- Supabase Service Role Key: âœ… å·²é…ç½®ï¼ˆç¯å¢ƒå˜é‡ä¸­ï¼‰

### 3. ç¯å¢ƒéš”ç¦»æ–¹æ¡ˆï¼ˆå•å®ä¾‹ï¼‰

è™½ç„¶åªæœ‰ä¸€ä¸ª Supabase å®ä¾‹ï¼Œä½†è¦æ±‚æµ‹è¯•å’Œçº¿ä¸Šæ•°æ®éš”ç¦»ï¼š

#### æ–¹æ¡ˆï¼šSchema éš”ç¦»ï¼ˆæ¨èï¼‰

```
PostgreSQL å®ä¾‹
â”œâ”€â”€ public           â† çº¿ä¸Šç¯å¢ƒï¼ˆé»˜è®¤ï¼‰
â”œâ”€â”€ test_public      â† æµ‹è¯•ç¯å¢ƒ
â””â”€â”€ auth             â† Supabase Authï¼ˆå…±äº«ï¼‰
```

**å®æ–½æ–¹å¼ï¼š**

1. **æ•°æ®åº“å±‚é¢**
   ```sql
   -- åˆ›å»ºæµ‹è¯• schema
   CREATE SCHEMA IF NOT EXISTS test_public;
   
   -- æµ‹è¯•è¡¨ç»“æ„å’Œçº¿ä¸Šå®Œå…¨ä¸€è‡´ï¼Œä½†æ•°æ®éš”ç¦»
   test_public.user_devices
   test_public.user_purchases
   test_public.profiles
   ```

2. **Flutter SDK å±‚é¢**
   ```dart
   class RocketWorkshopAuth {
     // é€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢ schema
     static String get schema {
       const env = String.fromEnvironment('ENV', defaultValue: 'prod');
       return env == 'test' ? 'test_public' : 'public';
     }
     
     // è¡¨ååŠ¨æ€è·å–
     String get userDevicesTable => '$schema.user_devices';
   }
   ```

3. **ç¯å¢ƒåˆ‡æ¢æ–¹å¼**
   ```bash
   # å¼€å‘æµ‹è¯•
   flutter run --dart-define=ENV=test
   
   # çº¿ä¸Šç¯å¢ƒ
   flutter run --dart-define=ENV=prod
   # æˆ– flutter build apk --dart-define=ENV=prod
   ```

4. **OSS è·¯å¾„éš”ç¦»**
   ```
   é˜¿é‡Œäº‘ OSS
   â”œâ”€â”€ prod/                 â† çº¿ä¸Š
   â”‚   â”œâ”€â”€ users/{user_id}/
   â”‚   â””â”€â”€ devices/{device_id}/
   â””â”€â”€ test/                 â† æµ‹è¯•
       â”œâ”€â”€ users/{user_id}/
       â””â”€â”€ devices/{device_id}/
   ```

**ä¼˜ç‚¹ï¼š**
- æ•°æ®å®Œå…¨éš”ç¦»ï¼Œä¸ä¼šæ±¡æŸ“çº¿ä¸Š
- æµ‹è¯•å¯ä»¥éšæ„åˆ é™¤/ä¿®æ”¹æ•°æ®
- éƒ¨ç½²ç®€å•ï¼Œä¸éœ€è¦å¤šä¸ªå®ä¾‹
- åˆ‡æ¢æ–¹ä¾¿ï¼Œæ”¹ç¯å¢ƒå˜é‡å³å¯

**æ³¨æ„äº‹é¡¹ï¼š**
- æµ‹è¯•ç¯å¢ƒå®šæœŸæ¸…ç†ï¼ˆé¿å…å­˜å‚¨æ— é™å¢é•¿ï¼‰
- æµ‹è¯•ç¯å¢ƒçŸ­ä¿¡å‘é€ä½¿ç”¨æ²™ç›’æ¨¡å¼
- è´­ä¹°éªŒè¯ä½¿ç”¨æ²™ç›’æ”¶æ®

---

## ğŸ“‹ é¡¹ç›®ç»“æ„è§„èŒƒ

```
rocket-workshop-supabase/
â”œâ”€â”€ AGENTS.md                   # æœ¬æ–‡ä»¶ï¼šå¼€å‘è§„èŒƒ
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ .gitignore                  # Git å¿½ç•¥é…ç½®
â”‚
â”œâ”€â”€ database/                   # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ init.sql               # çº¿ä¸Šç¯å¢ƒåˆå§‹åŒ–
â”‚   â”œâ”€â”€ init_test.sql          # æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–
â”‚   â””â”€â”€ migrations/            # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚
â”œâ”€â”€ flutter-sdk/               # Flutter SDK
â”‚   â”œâ”€â”€ rocket_workshop_auth/  # SDK æºç 
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth_service.dart      # ç™»å½•æœåŠ¡
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cloud_sync_service.dart # â­ äº‘åŒæ­¥æ ¸å¿ƒ
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ local_db_service.dart  # æœ¬åœ°æ•°æ®åº“
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ oss_service.dart       # OSS æ“ä½œ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ widgets/                   # UI ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ rocket_workshop_auth.dart      # ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ test/              # å•å…ƒæµ‹è¯•
â”‚   â”‚   â””â”€â”€ example/           # ç¤ºä¾‹ App
â”‚   â”‚
â”‚   â””â”€â”€ example_app/           # å®Œæ•´ç¤ºä¾‹åº”ç”¨
â”‚
â”œâ”€â”€ edge-functions/            # Supabase Edge Functions
â”‚   â”œâ”€â”€ verify-purchase/       # è´­ä¹°éªŒè¯
â”‚   â””â”€â”€ migrate-purchase/      # è´­ä¹°è¿ç§»
â”‚
â””â”€â”€ docs/                      # æ–‡æ¡£
    â”œâ”€â”€ architecture.md        # æ¶æ„è®¾è®¡
    â””â”€â”€ api.md                 # API æ–‡æ¡£
```

---

## âœ… æäº¤å‰æ£€æŸ¥æ¸…å•

- [ ] ä»£ç å·²è‡ªæµ‹é€šè¿‡
- [ ] æµ‹è¯•ç”¨ä¾‹å·²è¡¥å……
- [ ] æ²¡æœ‰ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
- [ ] ç¯å¢ƒéš”ç¦»å·²è€ƒè™‘
- [ ] æ–‡æ¡£å·²æ›´æ–°ï¼ˆå¦‚æœ‰æ¥å£å˜æ›´ï¼‰

---

## ğŸ“Š é¡¹ç›®è¿›åº¦

### å·²å®Œæˆ âœ…
- Supabase ç¯å¢ƒæ­å»ºï¼ˆæµ‹è¯•+çº¿ä¸Š schemaï¼‰
- æ•°æ®åº“è¡¨ç»“æ„ï¼ˆprofiles, user_apps, user_devices, user_purchasesï¼‰
- Flutter SDK åŸºç¡€ï¼ˆçŸ­ä¿¡ç™»å½•ï¼‰
- ç¤ºä¾‹ App æ¡†æ¶

### è¿›è¡Œä¸­ ğŸŸ¡
- çŸ­ä¿¡ç™»å½•æµ‹è¯•

### å¾…å¼€å‘ âŒ
- CloudSyncService æ ¸å¿ƒç±»
- OSS ä¸Šä¼ /ä¸‹è½½
- æ•°æ®è¿ç§»é€»è¾‘
- è´­ä¹°éªŒè¯ Edge Function
